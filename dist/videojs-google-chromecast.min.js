/*! @name videojs-google-chromecast @version 0.1.7 @license UNLICENSED */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("video.js/dist/alt/video.core.novtt.min")):"function"==typeof define&&define.amd?define(["video.js/dist/alt/video.core.novtt.min"],t):(e=e||self).videojsGoogleChromecast=t(e.videojs)}(this,(function(e){"use strict";e=e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e;var t=function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t};var i=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e},a=(e.getComponent("Component"),e.getComponent("ControlBar")),r=e.getComponent("Button"),s="IDLE",n="BUFFERING",o="LOADED",l="PLAYING",c="PAUSED",d=function(a){function r(e,t){var r;return(r=a.call(this,e,t)||this).player=e,r.options=t,r.incrementMediaTimeHandler=r.incrementMediaTime.bind(i(r)),r}t(r,a);var d=r.prototype;return d.initCastPlayer=function(e,t){var i=this,a=this;if(this.player=e,this.options=t,this.sources={},this.casting=!1,this.apiSession=null,this.mDNS=!1,this.client={},this.receivers=[],this.choosenDevice=null,this.initPlayerHandler(this),this.playerState=s,this.playerStateBeforeSwitch=null,this.remotePlayer=null,this.remotePlayerController=null,this.currentMediaTime=0,this.mediaDuration=-1,this.mediaInfo={},this.mediaInfoMDNS={},this.tryingReconnect=0,this.searchAttempts=5,this.timePerAttempt=1e3,this.selectedDevice=null,this.hide(),void 0!==t.appId&&""!==t.appId?this.appId=t.appId:chrome.cast.media.DEFAULT_MEDIA_RECEIVER_APP_ID&&(this.appId=chrome.cast.media.DEFAULT_MEDIA_RECEIVER_APP_ID),void 0!==t.autoJoinPolicy&&""!==t.autoJoinPolicy?this.autoJoinPolicy=t.autoJoinPolicy:chrome.cast.AutoJoinPolicy.PAGE_SCOPED&&(this.autoJoinPolicy=chrome.cast.AutoJoinPolicy.PAGE_SCOPED),cast.framework.CastContext.getInstance().setOptions({receiverApplicationId:this.appId,autoJoinPolicy:this.autoJoinPolicy}),void 0!==t.searchAttempts&&""!==t.searchAttempts&&(this.searchAttempts=t.searchAttempts),void 0!==t.timePerAttempt&&""!==t.timePerAttempt&&(this.timePerAttempt=t.timePerAttempt),void 0!==this.options.mdns&&this.options.mdns){this.mDNS=!0;var r=require("chromecast-api");this.client=new r,this.container=document.createElement("div"),this.container.setAttribute("class","ReactModalPortal"),this.container.setAttribute("id","containerModal"),this.contentModal='<div id="chromecastModal" class="chromecastModal ReactModal__Overlay ReactModal__Overlay--after-open modal-overlay"><div class="ReactModal__Content ReactModal__Content--after-open modal modal--card-internal" tabIndex="-1" role="dialog"><button id="closeCast" class="button button--close closeCast" type="button"><span class="button__content"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" className="icon icon--X"><g><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></g></svg></span></button><section class="card"><div class="card__header--between"><div class="card__title-section"><div><h2 className="card__title">Cast to...</h2></div></div><div></div></div><div class="card__main-actions">';this.client.on("device",(function(e){void 0!==e&&(i.receivers.push(e),i.contentModal+='<fieldset-section id="'+e.name+'" class="selectCast"><div id="'+e.name+'" class="castFriendlyName">'+e.friendlyName+'</div><div class="castLoader"></div></fieldset-section>')})),this.prepareMediaForCast((function(){})),function e(){!0===a.client.hasFinishLoad?a.receivers.length>0?(a.remotePlayer=new cast.framework.RemotePlayer,a.remotePlayerController=new cast.framework.RemotePlayerController(a.remotePlayer),a.apiInitialized=!0,setTimeout(a.initSearchProcess.bind(a),0)):(a.hide(),setTimeout(a.initSearchProcess.bind(a),a.timePerAttempt)):setTimeout(e,100)}()}else this.remotePlayer=new cast.framework.RemotePlayer,this.remotePlayerController=new cast.framework.RemotePlayerController(this.remotePlayer),this.remotePlayerController.addEventListener(cast.framework.RemotePlayerEventType.IS_CONNECTED_CHANGED,(function(e){i.switchPlayer(e.value)})),this.apiInitialized=!0,this.initializeUI(e),this.setupLocalPlayer()},d.initSearchProcess=function(){e.log("Searching Cast APIs..."),this.tryingReconnect<this.searchAttempts?this.receivers.length<=1?(++this.tryingReconnect,this.setTimeout(this.initSearchProcess,this.timePerAttempt)):(this.contentModal+="</div></section></div></div>",this.container.innerHTML=this.contentModal,this.remotePlayer=new cast.framework.RemotePlayer,this.remotePlayerController=new cast.framework.RemotePlayerController(this.remotePlayer),this.apiInitialized=!0,this.setupLocalPlayer(),this.initializeUI(this.player),this.show()):void 0===this.receivers||this.receivers.length<=0?e.log("Cast APIs not available. Max reconnect attempt"):(this.contentModal+="</div></section></div></div>",this.container.innerHTML=this.contentModal,this.remotePlayer=new cast.framework.RemotePlayer,this.remotePlayerController=new cast.framework.RemotePlayerController(this.remotePlayer),this.apiInitialized=!0,this.setupLocalPlayer(),this.initializeUI(this.player),this.show())},d.initPlayerHandler=function(e){void 0===e&&(e={}),this.playerHandler={},this.playerHandler.target={},this.playerHandler.setTarget=function(t){e.playerHandler.target=t},this.playerHandler.play=function(){e.playerState!==s&&e.playerHandler.target.isMediaLoaded()?(e.playerState=l,e.playerHandler.target.play()):e.playerHandler.load()},this.playerHandler.pause=function(){e.playerState=c,e.playerHandler.target.pause()},this.playerHandler.stop=function(){e.playerState=s,e.playerHandler.target.stop()},this.playerHandler.load=function(){e.playerState=n,e.playerHandler.target.load()},this.playerHandler.isMediaLoaded=function(){return e.playerHandler.target.isMediaLoaded()},this.playerHandler.prepareToPlay=function(){e.mediaDuration=e.playerHandler.getMediaDuration(),e.playerHandler.updateDurationDisplay(),e.playerState=o,e.playerHandler.play(),e.playerHandler.updateDisplay()},this.playerHandler.getCurrentMediaTime=function(){return e.playerHandler.target.getCurrentMediaTime()},this.playerHandler.getMediaDuration=function(){return e.playerHandler.target.getMediaDuration()},this.playerHandler.updateDisplay=function(){e.playerHandler.currentMediaTime=e.playerHandler.target.getCurrentMediaTime(),e.playerHandler.mediaDuration=e.playerHandler.target.getMediaDuration(),e.playerHandler.target.updateDisplay()},this.playerHandler.updateCurrentTimeDisplay=function(){e.playerHandler.target.updateCurrentTimeDisplay()},this.playerHandler.updateDurationDisplay=function(){e.playerHandler.target.updateDurationDisplay()},this.playerHandler.setTimeString=function(t){e.playerHandler.target.setTimeString(t)},this.playerHandler.setVolume=function(t){e.playerHandler.target.setVolume(t)},this.playerHandler.mute=function(){e.playerHandler.target.mute()},this.playerHandler.unMute=function(){e.playerHandler.target.unMute()},this.playerHandler.isMuted=function(){return e.playerHandler.target.isMuted()},this.playerHandler.seekTo=function(t){e.playerHandler.target.seekTo(t)}},d.initializeUI=function(e){void 0!==e.controlBar&&(this.createGoogleButton(),this.mDNS&&this.createCustomButton(),e.controlBar.chromecastButton=this)},d.createGoogleButton=function(){var e=document.getElementsByClassName("vjs-control-bar");if(document.getElementsByClassName("vjs-chromecast-button").length<=0){var t=document.createElement("google-cast-launcher");t.setAttribute("class","vjs-chromecast-button vjs-control vjs-button"),t.setAttribute("type","button"),e.length>0&&e[0].appendChild(t)}},d.createCustomButton=function(){var e=this,t=document.getElementsByClassName("vjs-control-bar");if(document.getElementsByClassName("vjs-chromecast-button-mdns").length<=0){var i=document.createElement("button");if(i.setAttribute("class","vjs-chromecast-button-mdns vjs-control vjs-button"),i.setAttribute("type","button"),i.addEventListener("click",(function(){e.findSources(),e.prepareMediaForCast((function(){document.body.appendChild(e.container),document.getElementById("closeCast").addEventListener("click",e.closeModal),document.getElementById("chromecastModal").addEventListener("click",e.closeModalFromBack);for(var t=document.getElementsByClassName("selectCast"),i=0;i<t.length;i++)t[i].addEventListener("click",e.selectCast.bind(e))}))})),t.length>0)t[0].appendChild(i),document.getElementsByClassName("vjs-chromecast-button-mdns")[0].innerHTML='<svg x="0px" y="0px" width="100%" height="100%" viewBox="0 0 24 24"><g><path id="cast_caf_icon_arch0" class="cast_caf_status_d" d="M1,18 L1,21 L4,21 C4,19.3 2.66,18 1,18 L1,18 Z"></path><path id="cast_caf_icon_arch1" class="cast_caf_status_d" d="M1,14 L1,16 C3.76,16 6,18.2 6,21 L8,21 C8,17.13 4.87,14 1,14 L1,14 Z"></path><path id="cast_caf_icon_arch2" class="cast_caf_status_d" d="M1,10 L1,12 C5.97,12 10,16.0 10,21 L12,21 C12,14.92 7.07,10 1,10 L1,10 Z"></path><path id="cast_caf_icon_box" class="cast_caf_status_d" d="M21,3 L3,3 C1.9,3 1,3.9 1,5 L1,8 L3,8 L3,5 L21,5 L21,19 L14,19 L14,21 L21,21 C22.1,21 23,20.1 23,19 L23,5 C23,3.9 22.1,3 21,3 L21,3 Z"></path><path id="cast_caf_icon_boxfill" class="cast_caf_state_h" d="M5,7 L5,8.63 C8,8.6 13.37,14 13.37,17 L19,17 L19,7 Z"></path></g></svg>'}},d.closeModal=function(e){var t=document.getElementById("containerModal"),i=t.cloneNode(!0);t.parentNode.replaceChild(i,t),document.body.removeChild(i)},d.closeModalFromBack=function(e){e.target===document.getElementById("chromecastModal")&&document.body.removeChild(document.getElementById("containerModal"))},d.selectCast=function(e){var t=this,i=e.target.id,a=document.getElementById(i).childNodes;a.length>0&&(a[1].style.opacity=1);for(var r=0;r<this.receivers.length;r++)this.receivers[r].name===i&&(this.selectedDevice=this.receivers[r]);null!=this.selectedDevice&&(this.player_.pause(),this.selectedDevice.play(this.mediaInfoMDNS,(function(i){a.length>0&&(a[1].style.opacity=0),i?(t.closeModal(e),t.casting=!1,document.getElementsByClassName("vjs-chromecast-button-mdns")[0].classList.add("error"),t.player_.play()):(t.playerHandler.load(),t.player_.loadTech_("ChromecastTech",{type:"cast",cast_:t,apiSession:t.apiSession}),t.closeModal(e),t.casting=!0,document.getElementsByClassName("vjs-chromecast-button-mdns")[0].classList.add("connected"))})))},d.hide=function(){a.prototype.hide.call(this);var e=document.getElementsByClassName("vjs-chromecast-button");e.length>0&&(e[0].style.display="none"),this.mDNS&&(e=document.getElementsByClassName("vjs-chromecast-button-mdns")).length>0&&(e[0].style.display="none")},d.show=function(){a.prototype.show.call(this);var e=null;(e=this.mDNS?document.getElementsByClassName("vjs-chromecast-button-mdns"):document.getElementsByClassName("vjs-chromecast-button")).length>0&&(e[0].style.display="block")},d.buildCSSClass=function(){return this.mDNS?"vjs-chromecast-button-mdns "+a.prototype.buildCSSClass.call(this,this):"vjs-chromecast-button "+a.prototype.buildCSSClass.call(this,this)},d.receiverListener=function(e){if(!this.disposed)return"available"===e?this.show():this.hide()},d.findSources=function(){var e=null;return null===this.player_?void 0!==this.player.cache_&&void 0!==this.player.cache_.source&&(e=this.player.cache_.source):e=this.player_.currentSource(),this.sources=e,void 0!==this.options.url&&""!==this.options.url&&(this.sources.src=this.options.url),this.sources},d.switchPlayer=function(e){var t=this;this.playerStateBeforeSwitch=this.playerState,e?this.prepareMediaForCast((function(){cast&&cast.framework&&t.remotePlayer.isConnected?(t.playerHandler.pause(),t.setupRemotePlayer()):t.setupLocalPlayer()})):this.prepareMediaForCast(this.setupLocalPlayer.bind(this))},d.setupRemotePlayer=function(){var t=this;this.remotePlayerController.addEventListener(cast.framework.RemotePlayerEventType.MEDIA_INFO_CHANGED,(function(e){var i=cast.framework.CastContext.getInstance().getCurrentSession();if(!i)return t.mediaInfo=null,void t.playerHandler.updateDisplay();var a=i.getMediaSession();if(!a)return t.mediaInfo=null,void t.playerHandler.updateDisplay();t.apiSession=i,t.mediaInfo=a.media,a.playerState===l&&t.playerState!==l&&t.playerHandler.prepareToPlay(),t.playerHandler.updateDisplay()})),this.remotePlayerController.addEventListener(cast.framework.RemotePlayerEventType.CAN_SEEK_CHANGED,(function(e){})),this.remotePlayerController.addEventListener(cast.framework.RemotePlayerEventType.IS_PAUSED_CHANGED,(function(){t.remotePlayer.isPaused?t.playerHandler.pause():t.playerState!==l&&t.playerHandler.play()})),this.remotePlayerController.addEventListener(cast.framework.RemotePlayerEventType.IS_MUTED_CHANGED,(function(){t.remotePlayer.isMuted?t.playerHandler.mute():t.playerHandler.unMute()})),this.remotePlayerController.addEventListener(cast.framework.RemotePlayerEventType.VOLUME_LEVEL_CHANGED,(function(){var e=t.remotePlayer.volumeLevel;t.isFunction(t.player_.setVolume)?t.player_.setVolume(e):t.player_.setVolume=e})),this.remotePlayerController.addEventListener(cast.framework.RemotePlayerEventType.IS_PLAYING_BREAK_CHANGED,(function(e){t.isPlayingBreak(e.value)})),this.remotePlayerController.addEventListener(cast.framework.RemotePlayerEventType.WHEN_SKIPPABLE_CHANGED,(function(e){t.onWhenSkippableChanged(e.value)})),this.remotePlayerController.addEventListener(cast.framework.RemotePlayerEventType.CURRENT_BREAK_CLIP_TIME_CHANGED,(function(e){t.onCurrentBreakClipTimeChanged(e.value)})),this.remotePlayerController.addEventListener(cast.framework.RemotePlayerEventType.BREAK_CLIP_ID_CHANGED,(function(e){t.onBreakClipIdChanged(e.value)})),this.remotePlayerController.addEventListener(cast.framework.RemotePlayerEventType.LIVE_SEEKABLE_RANGE_CHANGED,(function(i){e.log("LIVE_SEEKABLE_RANGE_CHANGED"),t.liveSeekableRange=i.value}));var i={};i.play=function(){this.remotePlayer.isPaused&&(this.remotePlayerController.playOrPause(),this.player_.play())}.bind(this),i.pause=function(){this.remotePlayer.isPaused||(this.remotePlayerController.playOrPause(),this.player_.pause())}.bind(this),i.stop=function(){this.remotePlayerController.stop()}.bind(this),i.load=function(){this.findSources(),this.prepareMediaForCast(function(){e.log("Loading..."+this.mediaInfo.metadata.title);var t=new chrome.cast.media.LoadRequest(this.mediaInfo);t.currentTime=this.currentMediaTime,this.playerStateBeforeSwitch&&this.playerStateBeforeSwitch!==c?t.autoplay=!0:t.autoplay=!1,cast.framework.CastContext.getInstance().getCurrentSession().loadMedia(t).then(function(){this.casting=!0,e.log("Remote media loaded")}.bind(this),function(t){this.playerState=s,e.log("Remote media load error: "+this.getErrorMessage(t)),this.playerHandler.updateDisplay()}.bind(this))}.bind(this))}.bind(this),i.isMediaLoaded=function(){var e=cast.framework.CastContext.getInstance().getCurrentSession();if(!e)return!1;var t=e.getMediaSession();return!!t&&(t.playerState!==s&&(this.apiSession=e,!0))}.bind(this),i.getCurrentMediaTime=function(){return this.remotePlayer.currentTime}.bind(this),i.getMediaDuration=function(){return this.remotePlayer.duration}.bind(this),i.updateDisplay=function(){var e=cast.framework.CastContext.getInstance().getCurrentSession();if(e&&e.getMediaSession()&&e.getMediaSession().media){var t=e.getMediaSession().media;if(t.metadata){var i=t.metadata.title,a=t.metadata.episodeTitle;i=(i=a?i+": "+a:i)?i+" ":"";var r=t.metadata.subtitle;r=r?r+" ":""}}else{this.currentTech.dispose(),this.casting=!1;var s=this.player_.currentTime();this.removeClass("connected"),this.player_.src(this.player_.options_.sources),this.player_.paused()||this.player_.one("seeked",(function(){return this.player_.play()})),this.player_.currentTime(s),this.player_.options_.inactivityTimeout=this.inactivityTimeout}}.bind(this),i.updateCurrentTimeDisplay=function(){this.playerHandler.setTimeString(this.playerHandler.getCurrentMediaTime())}.bind(this),i.updateDurationDisplay=function(){this.playerHandler.setTimeString(this.playerHandler.getMediaDuration())}.bind(this),i.setTimeString=function(e){this.getMediaTimeString(e)}.bind(this),i.setVolume=function(e){var t=this.remotePlayer.volumeLevel;t=e>1?1:e,this.remotePlayer.volumeLevel=t,this.remotePlayerController.setVolumeLevel()}.bind(this),i.mute=function(){this.remotePlayer.isMuted||this.remotePlayerController.muteOrUnmute()}.bind(this),i.unMute=function(){this.remotePlayer.isMuted&&this.remotePlayerController.muteOrUnmute()}.bind(this),i.isMuted=function(){return this.remotePlayer.isMuted}.bind(this),i.seekTo=function(e){this.remotePlayer.currentTime=e,this.remotePlayerController.seek()}.bind(this),this.playerHandler.setTarget(i),this.remotePlayer.isMuted&&this.playerHandler.mute(),this.apiSession=cast.framework.CastContext.getInstance().getCurrentSession(),this.player_.loadTech_("ChromecastTech",{type:"cast",cast_:this,apiSession:this.apiSession}),this.apiSession===cast.framework.SessionState.SESSION_RESUMED?this.playerHandler.prepareToPlay():this.playerHandler.load()},d.setupLocalPlayer=function(){var t={play:function(){e.log("local player play")},pause:function(){e.log("local player pause")},stop:function(){e.log("local player stop")},load:function(){e.log("local player load")}};t.isMediaLoaded=function(){return this.findSources(),null!==this.mediaInfo}.bind(this),t.getCurrentMediaTime=function(){return void 0!==this.player_?this.player_.currentTime():0}.bind(this),t.getMediaDuration=function(){return void 0!==this.player_?this.player_.duration():0}.bind(this),t.updateDisplay=function(){}.bind(this),t.updateCurrentTimeDisplay=function(){this.currentMediaTime+=1,this.playerHandler.setTimeString(this.currentMediaTime)}.bind(this),t.updateDurationDisplay=function(){this.playerHandler.setTimeString(this.mediaDuration)}.bind(this),t.setTimeString=function(e){this.getMediaTimeString(e)}.bind(this),t.setVolume=function(e){if(void 0!==this.player_)return this.player_.volume(e)}.bind(this),t.mute=function(){if(void 0!==this.player_)return this.player_.mute(!0)}.bind(this),t.unMute=function(){if(void 0!==this.player_)return this.player_.mute(!1)}.bind(this),t.isMuted=function(){if(void 0!==this.player_)return this.player_.mute()}.bind(this),t.seekTo=function(e){if(void 0!==this.player_)return this.player_.currentTime(e)}.bind(this),this.playerHandler.setTarget(t),this.playerHandler.setVolume(50),this.currentMediaTime>0&&(this.playerHandler.load(),this.playerHandler.play())},d.prepareMediaForCast=function(e){if(this.mediaInfo=new chrome.cast.media.MediaInfo(this.sources.src,this.sources.type),this.mediaInfo.streamType=chrome.cast.media.StreamType.BUFFERED,this.mediaInfo.metadata=new chrome.cast.media.TvShowMediaMetadata,this.mediaInfo.metadata.title="",this.mediaInfo.metadata.subtitle="",void 0===this.options.metadata&&(this.options.metadata={}),void 0!==this.options.metadata.title&&""!==this.options.metadata.title)this.mediaInfo.metadata.title=this.options.metadata.title;else{var t=document.getElementsByClassName("file-page__video");if(t.length>0)for(var i=0;i<t.length;i++){var a=t[i].getElementsByClassName("card__title");a.length>0&&(this.mediaInfo.metadata.title=a[0].innerText)}}if(void 0!==this.options.metadata.subtitle&&""!==this.options.metadata.subtitle)this.mediaInfo.metadata.subtitle=this.options.metadata.subtitle;else{var r=document.getElementsByClassName("file-page__video");if(r.length>0)for(var s=0;s<r.length;s++){var n=r[s].getElementsByClassName("channel-name");n.length>0&&(this.mediaInfo.metadata.subtitle=n[0].innerText)}}var o=this.player_.poster();if(o){var l=new chrome.cast.Image(o);this.mediaInfo.metadata.images=[{url:l}]}this.mediaInfoMDNS.url=this.sources.src,this.mediaInfoMDNS.cover={},this.mediaInfoMDNS.cover.title=this.mediaInfo.metadata.title,this.mediaInfoMDNS.cover.url=o,e()},d.onMediaLoadedLocally=function(){this.player_.currentTime(this.currentMediaTime),this.playerHandler.prepareToPlay()},d.seekMedia=function(t){null===this.mediaDuration||cast.framework.CastContext.getInstance().getCurrentSession()&&!this.remotePlayer.canSeek?e.log("Error - Not seekable"):(this.playerState!==l&&this.playerState!==c||(this.currentMediaTime=t),this.playerHandler.seekTo(t))},d.getErrorMessage=function(e){switch(e.code){case chrome.cast.ErrorCode.API_NOT_INITIALIZED:return"The API is not initialized."+(e.description?" :"+e.description:"");case chrome.cast.ErrorCode.CANCEL:return"The operation was canceled by the user"+(e.description?" :"+e.description:"");case chrome.cast.ErrorCode.CHANNEL_ERROR:return"A channel to the receiver is not available."+(e.description?" :"+e.description:"");case chrome.cast.ErrorCode.EXTENSION_MISSING:return"The Cast extension is not available."+(e.description?" :"+e.description:"");case chrome.cast.ErrorCode.INVALID_PARAMETER:return"The parameters to the operation were not valid."+(e.description?" :"+e.description:"");case chrome.cast.ErrorCode.RECEIVER_UNAVAILABLE:return"No receiver was compatible with the session request."+(e.description?" :"+e.description:"");case chrome.cast.ErrorCode.SESSION_ERROR:return"A session could not be created, or a session was invalid."+(e.description?" :"+e.description:"");case chrome.cast.ErrorCode.TIMEOUT:return"The operation timed out."+(e.description?" :"+e.description:"");default:return e}},d.endPlayback=function(){this.currentMediaTime=0,this.playerState=s,this.this.updateDisplay()},d.getMediaTimeString=function(e){if(null==e)return null;var t=!1;e<0&&(t=!0,e*=-1);var i=Math.floor(e/3600),a=Math.floor((e-3600*i)/60),r=Math.floor(e-3600*i-60*a);return i<10&&(i="0"+i),a<10&&(a="0"+a),r<10&&(r="0"+r),(t?"-":"")+i+":"+a+":"+r},d.incrementMediaTime=function(){this.currentMediaTime=this.playerHandler.getCurrentMediaTime(),this.mediaDuration=this.playerHandler.getMediaDuration(),this.playerHandler.updateDurationDisplay(),null===this.mediaDuration||this.currentMediaTime<this.mediaDuration?this.playerHandler.updateCurrentTimeDisplay():this.mediaDuration>0&&this.endPlayback()},d.isFunction=function(e){return e&&"[object Function]"==={}.toString.call(e)},r}(r);d.prototype.controlText_="Chromecast",a.prototype.options_.children.splice(a.prototype.options_.children.length-1,0,"chromeCastButton"),void 0===e.getComponent("ChromecastButton")&&e.registerComponent("ChromecastButton",d);var u=function(e){function i(t,i){var a;a=e.call(this,t,i)||this;var r=new d(t,i);return window.__onGCastApiAvailable=function(e){e&&r.initCastPlayer(t,i)},void 0!==i.mdns&&i.mdns&&window.__onGCastApiAvailable(!0),a}return t(i,e),i}(e.getComponent("Component"));u.prototype.options_={},e.options.children.push("chromecast"),e.addLanguage("en",{"CASTING TO":"CASTING TO"}),void 0===e.getComponent("Chromecast")&&e.registerComponent("Chromecast",u);var h=e.getTech("Tech"),p="IDLE",m="BUFFERING",y="PLAYING",f="PAUSED",v=function(a){function r(e,t){var r;return void 0===t&&(t={}),(r=a.call(this,e,t)||this).castBtn=r.options_.source.cast_,r.castBtn.mDNS?(r.apiSession=r.options_.source.apiSession,r.receiver=r.castBtn.selectedDevice.friendlyName):(r.apiSession=r.options_.source.apiSession,r.receiver=r.apiSession.getCastDevice().friendlyName),r.castBtn.currentTech=i(r),r.initializeUI(),r.update(),r.triggerReady(),r}t(r,a);var s=r.prototype;return s.initializeUI=function(){var e=this;this.on("dispose",(function(){e.onMediaStatusUpdate(),e.onSessionUpdate(!1)}))},s.createEl=function(){return e.dom.createEl("div",{id:this.options_.techId,className:"vjs-tech vjs-tech-chromecast"})},s.update=function(){this.el_.innerHTML='<div class="casting-image" style="background-image: url(\''+this.options_.poster+'\')"></div><div class="casting-overlay"><div class="casting-information"><div class="casting-icon"></div><div class="casting-description"><small>'+this.localize("CASTING TO")+"</small><br>"+this.receiver+"</div></div></div>"},s.onSessionUpdate=function(e){if(this.apiSession||this.castBtn.mDNS)return e?void 0:this.onStopAppSuccess()},s.onStopAppSuccess=function(){this.apiSession=null},s.onMediaStatusUpdate=function(){if(this.apiSession||this.castBtn.mDNS)switch(this.castBtn.playerState){case m:this.trigger("waiting");break;case p:this.trigger("timeupdate"),this.trigger("ended");break;case f:this.trigger("pause"),this.paused_=!0;break;case y:this.trigger("playing"),this.trigger("play"),this.paused_=!1}},s.src=function(e){},s.currentSrc=function(){if(this.apiSession||this.castBtn.mDNS)return this.castBtn.sources.src},s.castError=function(t){return e.log("Cast Error: "+JSON.stringify(t))},s.controls=function(){return!1},s.play=function(){var t=this;(this.apiSession||this.castBtn.mDNS)&&(this.paused_&&(this.castBtn.mDNS?this.castBtn.selectedDevice.resume((function(i){i&&e.log(i),t.castBtn.playerHandler.play()})):this.castBtn.playerHandler.play()),this.paused_=!1,this.trigger("play"))},s.pause=function(){var t=this;(this.apiSession||this.castBtn.mDNS)&&(this.paused_||(this.castBtn.mDNS?this.castBtn.selectedDevice.pause((function(i){i&&e.log(i),t.castBtn.playerHandler.pause()})):this.castBtn.playerHandler.pause()),this.paused_=!0,this.trigger("pause"))},s.paused=function(){return this.paused_},s.ended=function(){return"FINISHED"===chrome.cast.media.IdleReason},s.currentTime=function(){return this.apiSession||this.castBtn.mDNS?this.castBtn.remotePlayer.currentTime:0},s.setCurrentTime=function(t){var i=this;return this.apiSession||this.castBtn.mDNS?(this.castBtn.mDNS?this.castBtn.selectedDevice.seekTo(t,(function(a){a&&e.log(a),i.castBtn.remotePlayer.currentTime=t,i.castBtn.remotePlayerController.seek()})):(this.castBtn.remotePlayer.currentTime=t,this.castBtn.remotePlayerController.seek()),t):0},s.volume=function(){return this.volume_},s.buffered=function(){},s.duration=function(){return this.apiSession||this.castBtn.mDNS?this.castBtn.player_.duration():0},s.seeked=function(){return!0},s.seeking=function(){return!0},s.seekable=function(){return!0},s.setVolume=function(t,i){if(void 0===i&&(i=!1),this.apiSession||this.castBtn.mDNS){var a=new chrome.cast.Volume;a.level=t,a.muted=i,this.volume_=a.level,this.muted_=i,(new chrome.cast.media.VolumeRequest).volume=a,this.castBtn.mDNS&&this.castBtn.selectedDevice.setVolume(a.level,(function(t){t&&e.log(t)})),this.trigger("volumechange")}},s.muted=function(){return this.muted_},s.setMuted=function(t){var i=this,a=this.volume_;t&&(a=0),this.castBtn.mDNS?this.castBtn.selectedDevice.setVolume(a,(function(r){r&&e.log(r),i.setVolume(a,t)})):this.setVolume(a,t)},s.supportsFullScreen=function(){return!1},s.dispose=function(){a.prototype.dispose.call(this)},s.setPlaybackRate=function(e){this.playbackRate_=e},s.playbackRate=function(){return this.playbackRate_},r}(h);v.prototype.paused_=!1,v.prototype.options_={},v.isSupported=function(){return!0},h.withSourceHandlers(v),v.nativeSourceHandler={},v.nativeSourceHandler.canPlayType=function(e){return/^application\/(?:dash\+xml|(x-|vnd\.apple\.)mpegurl)/i.test(e)?"probably":/^video\/(mpd|mp4|webm|m3u8)/i.test(e)?"maybe":""},v.nativeSourceHandler.canPlaySource=function(e){return e.type?v.nativeSourceHandler.canPlayType(e.type):e.src?v.nativeSourceHandler.canPlayType(e.src):""},v.nativeSourceHandler.handleSource=function(e,t){t.src(e.src)},v.nativeSourceHandler.dispose=function(){},v.registerSourceHandler(v.nativeSourceHandler),v.prototype.featuresVolumeControl=!0,v.prototype.featuresPlaybackRate=!1,v.prototype.movingMediaElementInDOM=!0,v.prototype.featuresTimeupdateEvents=!0,v.prototype.featuresProgressEvents=!0,v.prototype.featuresNativeTextTracks=!1,v.prototype.featuresNativeAudioTracks=!1,v.prototype.featuresNativeVideoTracks=!1,e.options.chromecast={},void 0===e.getTech("ChromecastTech")&&e.registerTech("ChromecastTech",v),void 0===h.getTech("ChromecastTech")&&h.registerTech("ChromecastTech",v);var g=function(e){var t=this;if(!(!1===e||e&&!1===e.enabled)){if(["appId","altSource","metadata","searchAttempts","timePerAttempt","onStop","onError"].forEach((function(i){void 0===t.options_.chromecast&&(t.options_.chromecast=[]),e[i]="",void 0!==t.options_.chromecast[i]&&(e[i]=t.options_.chromecast[i])})),null!=e.videojs&&""!=e.videojs){var i=e.videojs;require("../src/js/tech/chromecast-tech")(i)}new u(t,e)}},C=e.registerPlugin||e.plugin;return void 0===e.getPlugin("chromecast")&&C("chromecast",g),g.VERSION="0.1.7",g}));
